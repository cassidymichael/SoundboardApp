<UserControl x:Class="Soundboard.Views.Controls.TileControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="100" d:DesignWidth="100">

    <UserControl.Resources>
        <!-- Main tile button style -->
        <Style x:Key="TileButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                BorderThickness="3"
                                BorderBrush="Transparent">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryDarkerBrush}"/>
                            </Trigger>
                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentBrush}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding HasSound}" Value="False">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource EmptyTileBrush}"/>
                            </DataTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Button x:Name="TileButton" Style="{StaticResource TileButtonStyle}">
            <StackPanel VerticalAlignment="Center" Margin="6,8,6,20">
                <!-- Tile Name -->
                <TextBlock Text="{Binding Name}"
                       FontWeight="SemiBold"
                       FontSize="14"
                       TextAlignment="Center"
                       TextWrapping="Wrap"
                       TextTrimming="CharacterEllipsis"
                       MaxHeight="40"/>

                <!-- Hotkey Label -->
                <TextBlock Text="{Binding HotkeyDisplay}"
                       FontSize="11"
                       Opacity="0.7"
                       TextAlignment="Center"
                       Margin="0,2,0,0"/>
            </StackPanel>
        </Button>

        <!-- Progress Bar (fixed at bottom, animated via code-behind) -->
        <Grid Margin="12,0,12,14" Height="4"
              VerticalAlignment="Bottom"
              Visibility="{Binding IsPlaying, Converter={StaticResource BoolToVisibilityConverter}}"
              IsHitTestVisible="False">
            <Border Background="{StaticResource OverlayMediumBrush}" CornerRadius="2"/>
            <Border x:Name="ProgressBar" Background="White" CornerRadius="2"
                    HorizontalAlignment="Stretch"
                    RenderTransformOrigin="0,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="ProgressScale" ScaleX="0" ScaleY="1"/>
                </Border.RenderTransform>
            </Border>
        </Grid>

        <!-- Stop X button (top-right overlay, only when playing) -->
        <Button Command="{Binding StopCommand}"
                Visibility="{Binding IsPlaying, Converter={StaticResource BoolToVisibilityConverter}}"
                HorizontalAlignment="Right" VerticalAlignment="Top"
                Margin="0,8,8,0"
                Width="18" Height="18"
                Padding="0" BorderThickness="0"
                Background="{StaticResource OverlayDarkBrush}" Cursor="Hand"
                ToolTip="Stop">
            <Button.Template>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="4">
                        <Path Data="M 0,0 L 8,8 M 8,0 L 0,8"
                              Stroke="White" StrokeThickness="2"
                              Margin="1,1,1,1"
                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="border" Property="Background" Value="{StaticResource OverlayDarkerBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Button.Template>
        </Button>
    </Grid>
</UserControl>
